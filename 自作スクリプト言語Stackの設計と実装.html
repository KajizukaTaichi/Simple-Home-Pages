<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>自作スクリプト言語Stackの設計と実装</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h2 id="自作スクリプト言語stackの設計と実装">自作スクリプト言語Stackの設計と実装</h2>
<p>梶塚太智</p>
<h3 id="はじめに">はじめに</h3>
<p>私がこの研究を始めた動機は、以前取り組んでいた別の自作言語プロジェクトの反省と、スクリプト言語の利便性を最大限に高めたいという知的好奇心からである。</p>
<p>以前のプロジェクトは「Simple」という教育用言語を開発しており、言語を外側から見ると美しく教育用言語として相応しかったが、その内部実装のコードが肥大化し保守性が低下してしまっていた。具体的には実行ロジックが文と式で二重構造になっている、エラー処理が複雑化する等の問題を抱えていた。</p>
<p>当時私はLISPも勉強しており、LISPのメタプログラミングなど動的型システムや強力で利便性の高い機能に着想を得た。それは私の知的好奇心を刺激し、Simpleの改良版として便利な機能を盛り込んだ新しいスクリプト言語として作れないかと思ったのである。</p>
<p>そのような状況下でSimpleの反省と利便性の追求から生まれたのが今回研究した「Stack」というスクリプト言語なのである。</p>
<h3 id="stackの設計">Stackの設計</h3>
<p>Stackの設計の際は以下の3点を留意した。</p>
<ul>
<li>
<p>内部実装の簡潔化</p>
</li>
<li>
<p>構文解析の徹底</p>
</li>
<li>
<p>利便性の追求</p>
</li>
</ul>
<p>内部実装の簡潔化は、先ほど述べたSimpleの複雑な二重構造を改め、完全なるスタックベースの実行ロジックを採用したのである。Simpleでも式の評価のみにスタックを用いていたが、Stackはif条件分岐やwhileループまで全ての処理をスタックだけで行っている。</p>
<p>構文解析の徹底は、Simpleでは非常に曖昧な構文であったが、Stackではトークンを改行やタブ・スペースで区切るという明確なルールが存在し曖昧さがない分かりやすい構文にする事を注力した。そのトークン列はデータとコマンドからなり、データは文字通り処理するデータで、コマンドはStackで実行できるデータを処理する命令セットである。コマンドは一貫して引数の取得と戻り値の返却はスタックで行われる。</p>
<p>利便性の追求は、正規表現やHTTPリクエストの送信などSimpleにはない便利なコマンドを幅広く実装し、ユーザにとってより使いやすい言語にする様にした。また、シェルスクリプトとしても使えるようにファイルシステム操作系のコマンドを充実させている。</p>
<p>この様な基本方針のもとStackを設計した。</p>
<h3 id="処理系の実装">処理系の実装</h3>
<p>プログラミング言語には当然のことだが処理系が不可欠である。Stackの処理系はスクリプト言語ゆえにインタプリタ方式で、開発言語は私の愛用しているシステムプログラミング言語であるRustを使用した。</p>
<p>実行ロジックは構造体Executorでデータスタックや変数の名前空間を一元管理し、そのメソッドであるanalyze_syntaxで構文解析を、evalute_programでプログラムの評価を、execute_commandでコマンドの実行をそれぞれ担った。</p>
<p>型は最初、64bitの浮動小数点数のnumber型、ユニコード文字列のstring型、条件式に使う論理値のbool型、色々なデータを保持できるlist型があった。後になってエラー処理のerror型、ユーザ定義オブジェクトのobject型が追加された。</p>
<p>データはコマンド実行時に適切に暗黙の型変換するようになっておりユーザは型を意識せずプログラミングが可能である。これは余談だが、開発スタートから僅か3時間でFizzBuzz問題を解けたほどインタプリタが簡潔なコードをしているのだ。</p>
<h3 id="評価">評価</h3>
<p>Stackの自己評価は非常に高く私の自信作になっていて、周囲からのフィードバックも肯定的なのが多い。特にif条件分岐などで実行するコードを文字列データとして表し処理するメタプログラミング機構は非常に秀逸で、柔軟性の高いプログラムが組める特長がある。</p>
<p>他の既存のスクリプト言語に対しての優位性は何と言ってもその手軽さであろう。ほかの言語では数行かかる正規表現になんとワンライナーでも掛けるという簡易さを持っている。</p>
<p>Pythonでは正規表現に以下のコードを用いる</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">import</span> re
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>“<span class="token punctuation">,</span><span class="token operator">*</span>”<span class="token punctuation">,</span> “Hello<span class="token punctuation">,</span> world!”<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>メソッドが多く覚えるだけでも大変である。しかし、Stackなら以下の様に掛ける。</p>
<pre class=" language-stack"><code class="prism  language-stack">(Hello, world!) (,*) regex print
</code></pre>
<p>Stackでは言語コアで正規表現をサポートしているためライブラリのインポートが不要なだけでなく、正規表現のコマンドは汎用性が高く初心者でも迷いがないことが特長である。さらに特筆すべきは、スタックベースなので適用型言語とは違い連鎖的にコードが書けることだ。これはコードを書きやすくするだけでなく、可読性もネストが起こりにくいので良好に保てるという特徴がある。</p>
<h3 id="まとめ">まとめ</h3>
<p>本研究では、自作スクリプト言語Stackの設計と実装に焦点を当て、以前のプロジェクトからの反省とスクリプト言語の利便性への関心から生まれた新しい言語の開発プロセスを詳細に説明した。内部実装の簡潔化、構文解析の徹底、利便性の追求という基本方針に基づき、柔軟性の高いスクリプト言語が実現された。</p>
<p>今後の展望としては、Stackのさらなる拡張と改善が挙げられる。具体的には、新しい機能やライブラリの追加、パフォーマンスの向上、そしてコミュニティの形成と成長が重要である。また、Stackの教育用途や産業用途での実践的な活用にも注力することで、言語の普及と発展に貢献できるだろう。さらに、Stackの解説書やチュートリアルの提供、オープンソースコミュニティの形成など、Stackを広く普及させるための取り組みが必要である。</p>
<p>自作スクリプト言語Stackの設計と実装に関する研究は、スクリプト言語の新たな可能性を開拓し、プログラミング言語の設計と実装に興味を持つ人々に新たな知識と洞察を提供するものである。今後の発展に期待が高まる。</p>
</div>
</body>

</html>
